/*! 路由处理程序 2015-04-09 */
var guid=require("guid"),async=require("async"),_=require("lodash"),conf=require("node-conf"),basedir=Venus.baseDir,Schemas=require(basedir+"/database/schema").Schemas,logger=require(basedir+"/lib/logger").logger("web"),commfun=require(basedir+"/lib/comfun"),fs=require("fs"),util=require("util"),gets={},posts={};module.exports={get:gets,post:posts};var checkFun={};gets.index=function(a,b,c,d){b.render("manage/SysSet/list.html",{baseurl:d})},posts.baseConf=function(a,b,c,d){b.render("manage/SysSet/baseConf.html",{baseurl:d,baseConf:conf.load("app")})},posts.baseConfSave=function(a,b,c,d){var e=commfun.cloneobj(a.body);e.allowips=e.allowips.split(","),e.hostport=Number(e.hostport),e.debug=Boolean(Number(e.debug));var f=JSON.stringify(e,null,"\n");fs.writeFile(basedir+"/config/app.json",f,function(a){b.send(a?{success:!1,msg:"保存失败:"+a}:{success:!0,msg:"保存成功！"})})},posts.DbConf=function(a,b,c,d){b.render("manage/SysSet/DbConf.html",{baseurl:d,DbConf:conf.load("jdmysql")})},posts.DbConfSave=function(a,b,c,d){var e=commfun.cloneobj(a.body);e.port=Number(e.port),e.log=Boolean(Number(e.log)),e.slave=Boolean(Number(e.slave)),e.debug=Boolean(Number(e.debug));var f=JSON.stringify(e,null,"\n"),g=require("fs");g.writeFile(basedir+"/config/jdmysql.json",f,function(a){b.send(a?{success:!1,msg:"保存失败:"+a}:{success:!0,msg:"保存成功！"})})},posts.AsConf=function(a,b,c,d){b.render("manage/SysSet/AsConf.html",{baseurl:d,AsConf:conf.load("asterisk")})},posts.AsConfSave=function(a,b,c,d){var e=commfun.cloneobj(a.body);e.port=Number(e.port);var f=JSON.stringify(e,null,"\n"),g=require("fs");g.writeFile(basedir+"/config/asterisk.json",f,function(a){b.send(a?{success:!1,msg:"保存失败:"+a}:{success:!0,msg:"保存成功！"})})},posts.SysLog=function(a,b,c,d){fs.readFile(basedir+"/web.log",function(a,c){a?b.render("manage/SysSet/SysLog.html",{baseurl:d,Log:a}):b.render("manage/SysSet/SysLog.html",{baseurl:d,Log:c})})},posts.ClearSysLog=function(a,b,c,d){fs.writeFile(basedir+"/web.log","",function(a){b.send(a?{success:!1,msg:"清理失败:"+a}:{success:!0,msg:"清理成功！"})})},posts.SysOption=function(a,b,c,d){a.body.optionType;b.send({success:!0,msg:"清理成功！"})};