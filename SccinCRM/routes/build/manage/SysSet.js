/*! 路由处理程序 2014-08-08 */
var guid=require("guid"),async=require("async"),_=require("lodash"),conf=require("node-conf"),basedir=conf.load("app").appbase,Schemas=require(basedir+"/database/schema").Schemas,logger=require(basedir+"/lib/logger").logger("web"),commfun=require(basedir+"/lib/comfun"),fs=require("fs"),gets={},posts={};module.exports={get:gets,post:posts};var checkFun={};gets.index=function(a,b,c,d){b.render("manage/SysSet/list.html",{baseurl:d})},posts.baseConf=function(a,b,c,d){b.render("manage/SysSet/baseConf.html",{baseurl:d,baseConf:conf.load("app")})},posts.baseConfSave=function(a,b){var c=commfun.cloneobj(a.body);c.allowips=c.allowips.split(","),c.hostport=Number(c.hostport),c.debug=Boolean(Number(c.debug));var d=JSON.stringify(c,null,"\n");fs.writeFile(basedir+"/config/app.json",d,function(a){b.send(a?{success:!1,msg:"保存失败:"+a}:{success:!0,msg:"保存成功！"})})},posts.DbConf=function(a,b,c,d){b.render("manage/SysSet/DbConf.html",{baseurl:d,DbConf:conf.load("jdmysql")})},posts.DbConfSave=function(a,b){var c=commfun.cloneobj(a.body);c.port=Number(c.port),c.log=Boolean(Number(c.log)),c.slave=Boolean(Number(c.slave)),c.debug=Boolean(Number(c.debug));var d=JSON.stringify(c,null,"\n"),e=require("fs");e.writeFile(basedir+"/config/jdmysql.json",d,function(a){b.send(a?{success:!1,msg:"保存失败:"+a}:{success:!0,msg:"保存成功！"})})},posts.AsConf=function(a,b,c,d){b.render("manage/SysSet/AsConf.html",{baseurl:d,AsConf:conf.load("asterisk")})},posts.AsConfSave=function(a,b){var c=commfun.cloneobj(a.body);c.port=Number(c.port);var d=JSON.stringify(c,null,"\n"),e=require("fs");e.writeFile(basedir+"/config/asterisk.json",d,function(a){b.send(a?{success:!1,msg:"保存失败:"+a}:{success:!0,msg:"保存成功！"})})},posts.SysLog=function(a,b,c,d){fs.readFile(basedir+"/web.log",function(a,c){a?b.render("manage/SysSet/SysLog.html",{baseurl:d,Log:a}):b.render("manage/SysSet/SysLog.html",{baseurl:d,Log:c})})},posts.ClearSysLog=function(a,b){fs.writeFile(basedir+"/web.log","",function(a){b.send(a?{success:!1,msg:"清理失败:"+a}:{success:!0,msg:"清理成功！"})})},posts.SysOption=function(a,b){a.body.optionType;b.send({success:!0,msg:"清理成功！"})};