 <div class="layout_main"> 
 <div class="page_box">
    <div class="column form-column main col form-horizontal">
      <div class="panel panel-default fieldset">
        <div class="panel-heading"> 
        <button data-toggle="modal" data-target="#myModal" class="btn btn-primary">新建分机分组</button>
        </div>
        <div class="panel-body ">
          <div class="form-group">
            <label for="groupname" class="control-label col-sm-2">分组名称</label>
            <div class="controls  col-sm-3">
              <input type="text" value="" name="groupname" id="groupname"  class="form-control input-sm"> 
            </div>
              <div class="controls  col-sm-2">
                <input type="button" class="btn btn-primary btn-sm" id="search" value="查询">
              </div>             
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
   <table class="table table-striped table-hover table-condensed table-bordered" id="datatable">
      <colgroup>
      <col style="width: 15%;">
      <col style="width: 15%;">
      <col style="width: 10%;">
      <col style="width: 15%;">
      <col style="width: 15%;">
      <col style="width: 30%;">
      </colgroup>
      <thead>
        <tr>
          <th>分组编号</th>
          <th>分组名称</th>
          <th>成员(数)</th>
          <th>备注</th>
          <th class="text-center">创建时间</th>
          <th class="text-center">操作</th>
        </tr>
      </thead>
      <tbody>
</tbody>
<tfoot>
     <tr>
          <th>分组编号</th>
          <th>分组名称</th>
          <th>成员(数)</th>
          <th>备注</th>
          <th class="text-center">创建时间</th>
          <th class="text-center">操作</th>
        </tr>
  </tfoot>
</table>
</div>


<script type="text/javascript">
$(function(){
  $('#datatable').tooltip();
var ajaxUrl="/pagination";
var oTable=$('#datatable').dataTable({
  sDom: "<'row'<'col-sm-4'l><'col-sm-4'f><'col-sm-4'T>r>t<'row'<'col-sm-4'i><'col-sm-8 center'p>>",
  sPaginationType: "bootstrap", 
  //bDestroy:true,
  bInfo: true,
  oLanguage: {
  "sUrl":"/media/olanguage.json"
  },
  sScrollX: "100%",
  bScrollCollapse: true,
    bPaginate: true,
    bFilter:false,
    bProcessing: true,
    bServerSide: true,
    sAjaxSource: ajaxUrl,
    sServerMethod: "POST",
    fnServerParams: function (aoData) {
    var where=  getWhere();
    for(var key in where){
     aoData.push( { "name": key, "value":where[key]} );
    }    
    },
    aoColumnDefs: getColums(),
     oTableTools: {
             sSwfPath: "/css/datatable/css/swf/copy_csv_xls_pdf.swf",
             aButtons: [{
          "sExtends": "copy",
          "sButtonText": "复制"
        },{
                  "sExtends": "xls",
                    "sButtonText": "导出该页" ,
                     "bFooter": false,
                    "sFileName": "列表.xls" 
                },
     { 
      "sExtends": "extxls", 
      "sAjaxUrl": ajaxUrl,
      "sKeys":getToolWhere().sColumns.split(','), 
      "sButtonText": "导出全部",
      "bFooter": false,
      "fnParameters":function(){return getToolWhere();},
      "sFileName": "列表.xls"  
     },{
      "sExtends":"print",
      "sButtonText": "打印该页" ,
      "sInfo": "<h6>打印本页</h6><p>请使用浏览器的打印功能 " + "打印本页. 按ESC键退出.</p>",
      "sMessage": "列表",
      "bShowAll": true
     } 
                                
                                                   
                              ]
  },
    //fnRowCallback fnCreatedRow
     fnRowCallback: function( nRow, aData, iDataIndex ) {
      $(nRow).click(function(e){
        var self=this;
        if ( $(self).hasClass('row_selected') ) {
            $(self).removeClass('row_selected');
        }
        else {
            oTable.$('tr.row_selected').removeClass('row_selected');
            $(self).addClass('row_selected');
        }
      });
    }
   
});



$('#search').click(function(){
 var oTable=$('#datatable').dataTable();
 oTable.fnDraw();
});

$('#createexten').click(function(){
  var DeviceProto=$('#DeviceProto').val();
  location.href='/PBXExtension/create?deviceproto='+DeviceProto;
});

}).keydown(function(){ 
if(event.keyCode == 13) 
$("#search").click();}
);

function getWhere(){
var where={};
where.dbName='PBXExtenGroup';
//gt > gete >=  lt  < lte <=   inq IN nin NOT IN neq  != like  LIKE
where.whereCount=1;//添加需要查询的条件个数
where.whereCol_0='groupname';
where.whereWay_0='like';
where.whereValue_0='%'+$('#groupname').val()+'%';
return where;
}

function getToolWhere(){
  var where=getWhere();
  var toolswhere={};
for(var key in where){
  toolswhere[key]=where[key];
}

toolswhere.sColumns='';

var colums=getColums();
toolswhere.iSortingCols=0;
for(var i=0;i<colums.length;i++){
 if(toolswhere.sColumns!=='')
  toolswhere.sColumns+=','+colums[i].mData;
else
  toolswhere.sColumns=colums[i].mData;

if(colums[i].asSorting && colums[i].asSorting.length>0){
  toolswhere['iSortCol_'+toolswhere.iSortingCols]=toolswhere.iSortingCols;
  toolswhere['sSortDir_'+toolswhere.iSortingCols]=colums[i].asSorting[0];
   toolswhere['bSortable_'+toolswhere.iSortingCols]=colums[i].bSortable;
  
  toolswhere.iSortingCols++;

}

}

toolswhere.iDisplayStart=0;
toolswhere.iDisplayLength=-1;
return toolswhere;
}

function getColums(){
  var colums=[
      {"asSorting": [ "asc" ], "sClass":'center',"sName":"id","mData": "id","bSortable": true,"bVisible": true, "aTargets": [0] },
      { "sClass":'center',"sName":"groupname","mData": "groupname","bSortable": false,"bVisible": true, "aTargets": [1] },
      { "sClass":'center',"sName":"extensions","mData": "extensions","bSortable": false,"bVisible": true, "aTargets": [2],"mRender":function(data,type,full){
        if(data!=null){
          var str='<div><span data-toggle="tooltip" data-placement="right" title="Tooltip on right">提示</span></div>';
          return str;
        }
      } },
      { "sClass":'center',"sName":"memo","mData": "memo","bSortable": false,"bVisible": true, "aTargets": [3] },
      { "sClass":'center',"sName":"cretime","mData": "cretime","bSortable": false,"bVisible": true, "aTargets": [4] },
      { "sClass":'center',"sName":"id","mData": "id","bSortable": false,"bVisible": true, "aTargets": [5] ,"mRender": function ( data, type, full ) {
        var str='<a class="btn btn-primary btn-xs" href="/PBXExtension/edit?id='+data+'">编辑</a>';
            str+='<a class="btn btn-danger btn-xs" href="javascript:delexten('+data+');">删除</a>'
        return str;
      }}
    ];
    return colums;
}

function delexten(id){
  $.ajax({
                type: "POST",
                url:'/PBXExtension/delete',
                data:{id:id},// 你的formid
                async: false,
                error: function(request) {
                   $.scojs_message('连接服务器失败！', $.scojs_message.TYPE_ERROR);
                },
                success: function(data) {
                  if(data.success==='OK'){
                   var oTable=$('#datatable').dataTable();
                       oTable.fnDraw();
                  }
                  $.scojs_message(data.msg, $.scojs_message['TYPE_'+data.success]);                  
                }
            }); 
}



</script>
