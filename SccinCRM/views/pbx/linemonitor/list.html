<div class="layout_main">
    <div class="page_box">
        <div class="column form-column main col form-horizontal">
            <div class="panel panel-default fieldset">
                <div class="panel-heading">
                    <a href="#" class="btn btn-primary">语音服务器线路监控</a>
                </div>
                <div class="panel-body ">
          <div class="form-group">
            <label for="id" class="control-label col-sm-2">监控中继</label>
            <div class="controls  col-sm-3">
             <select name="trunkid" id="trunkid" class="form-control input-sm">
                <option value="-1">全部</option>
              </select>
            </div>
           
            
              <div class="controls  col-sm-2">
                <input type="button" class="btn btn-primary btn-sm" id="search" value="查询">
              </div>             
            </div>
          </div>
              
                </div>
            </div>
        </div>
    </div>
</div>
<table class="table table-striped table-hover table-condensed table-bordered" id="datatable">
    <thead>
    <tr>

    </tr>
    <tr>
        <th class="text-center">中继名称</th>
        <th class="text-center">通道号</th>
        <th class="text-center">语音通道</th>
        <th class="text-center">状态</th>
        <th class="text-center">呼叫等级</th>
        <th class="text-center">线路名称</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
    <tr>
        <th class="text-center">中继名称</th>
        <th class="text-center">通道号</th>
        <th class="text-center">语音通道</th>
        <th class="text-center">状态</th>
        <th class="text-center">呼叫等级</th>
        <th class="text-center">线路名称</th>
    </tr>
    </tfoot>
</table>
</div>

<script type='text/javascript'>
$(function(){
var ajaxUrl="/pbx/linemonitor/bytable";
var oTable=$('#datatable').dataTable({
  sDom: "<'row'<'col-sm-4'l><'col-sm-4'f><'col-sm-4'T>r>t<'row'<'col-sm-4'i><'col-sm-8 center'p>>",
  sPaginationType: "bootstrap", 
  //bDestroy:true,
  bInfo: true,
  oLanguage: {
  "sUrl":"/media/olanguage.json"
  },
  sScrollX: "100%",
  bScrollCollapse: true,
  iDisplayLength: 5,
    bPaginate: false,
    bAutoWidth:false,
    bFilter:false,
    bProcessing: true,
    bServerSide: true,
    sAjaxSource: ajaxUrl,
    sServerMethod: "POST",
    aaSorting: getaaSorting(),
    fnServerParams: function (aoData) {
    var where = getWhere();
    for(var key in where){
     aoData.push( { "name": key, "value":where[key]} );
    }    
    },
    aoColumnDefs: getColums(),
     oTableTools: {
             sSwfPath: "/css/datatable/css/swf/copy_csv_xls_pdf.swf",
             aButtons: []
  },
    //fnRowCallback fnCreatedRow
     fnRowCallback: function( nRow, aData, iDataIndex ) {
      $(nRow).click(function(e){
        var self=this;
        if ( $(self).hasClass('row_selected') ) {
            $(self).removeClass('row_selected');
        }
        else {
            oTable.$('tr.row_selected').removeClass('row_selected');
            $(self).addClass('row_selected');
        }
      });
    }
   
});
});
</script>

<script type='text/javascript'>
$(function() {
  $(".tipmsg").tooltip();
  //绑定查询按钮
  $('#search').click(function() {
    var oTable = $('#datatable').dataTable();
    oTable.fnDraw();
  });


}).keydown(function() {
  if (event.keyCode == 13)
    $("#search").click();
});


</script>

<script type="text/javascript">

    function getWhere() {
        var where = {};
        where.dbName = '<%= modename%>';
//gt > gete >=  lt  < lte <=   inq IN nin NOT IN neq  != like  LIKE
        where.whereCount = 1;//添加需要查询的条件个数
        where.whereCol_0='trunkid';
        where.whereWay_0='';
        where.whereValue_0=$("#trunkid").val();
        return where;
    }

    function getToolWhere() {
        var where = getWhere();
        var toolswhere = {};
        for (var key in where) {
            toolswhere[key] = where[key];
        }

        toolswhere.sColumns = '';

        var colums = getColums();
        toolswhere.iSortingCols = 0;
        for (var i = 0; i < colums.length; i++) {
            if (toolswhere.sColumns !== '')
                toolswhere.sColumns += ',' + colums[i].mData;
            else
                toolswhere.sColumns = colums[i].mData;

            if (colums[i].asSorting && colums[i].asSorting.length > 0) {
                toolswhere['iSortCol_' + toolswhere.iSortingCols] = toolswhere.iSortingCols;
                toolswhere['sSortDir_' + toolswhere.iSortingCols] = colums[i].asSorting[0];
                toolswhere['bSortable_' + toolswhere.iSortingCols] = colums[i].bSortable;

                toolswhere.iSortingCols++;

            }

        }

        toolswhere.iDisplayStart = 0;
        toolswhere.iDisplayLength = -1;
        return toolswhere;
    }

    //设置默认排序列
    function getaaSorting() {
        return [
            [1, 'asc']
        ];
    }

    function getColums() {
        var colums = [
            { "asSorting": [ "asc" ], "sClass": 'center', "sName": "trunkname", "mData": "trunkname", "bSortable": false, "bVisible": true, "aTargets": [0] },
            { "sClass": 'center', "sName": "chan", "mData": "chan", "bSortable": true, "bVisible": true, "aTargets": [1] },
            { "sClass": 'center', "sName": "bchan", "mData": "bchan", "bSortable": false, "bVisible": true, "aTargets": [2] },
            { "sClass": 'center', "sName": "idle", "mData": "idle", "bSortable": false, "bVisible": true, "aTargets": [3] },
            { "sClass": 'center', "sName": "level", "mData": "level", "bSortable": false, "bVisible": true, "aTargets": [4] },
            { "sClass": 'center', "sName": "channame", "mData": "channame", "bSortable": false, "bVisible": true, "aTargets": [5]}
        ];
        return colums;
    }
</script>
